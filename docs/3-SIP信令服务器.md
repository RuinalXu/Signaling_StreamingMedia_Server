# 第30个视频
# 1 初始化sip信令协议栈并设置信令服务端口
内存池与内存池工厂

endpoint
- 消息的接收和响应


- 在继承过程中，基类定义了一个虚函数，想利用多态来实现不同的事件处理，那么需要将基类的析构函数也设置为`virtual`，这样基类才会产生虚表，一层一层释放内存空间，如果基类析构函数函数标识为`virtual`，那么在使用`delete`释放用子类对象实例化基类（多态的创建）所创建的对象时，基类分配的动态创建的内存才会被释放，避免内存泄漏。
- 并且释放是自下往基类开始释放；

# 2 上级注册管理
在上级服务服务中使用多态搭建任务事件处理框架，利用多态来实现不同的注册业务逻辑
- 鉴权注册：
    - 创建txdata，获取响应地址，发送响应，这三步就是上级对非鉴权注册请求的具体业务处理和响应；
- 非鉴权注册
- 下级注册与注销请求
    - 当下级发送的Message Header中的`Expires`字段大于0时，则为下级向上级发送的注册请求；为0时，则为下级向上级发送的注销请求；
    - 而且这个“判断下级是注册还是注销”需要在“发送响应”之后判断，先判断响应码是否为200，再判断`Expires`字段；
        - 如果是注册，那么就向记录当前注册时间t_0，并将Message Header中的`Register`字段修改为true；
            - 获取时间的目的是为了使用当前的时间与注册时的时间t_0作差，与`Expires`比较，得到注册信息是否过时；
        - 如果是注销，那么只需要将注册时记录的时间t_0设置为0，并将Message Header中的`Register`字段修改为false；
有效期定时检查：利用

# 下级信令服务器注册

鉴权的请求信息WWW-Authenticate，认证字段（类似于HTTP响应头），构成：<加密认证方案> <参数1>=<值1> ...
- Authenticate Scheme：加密认证方案
    - 常用的加密认证方案：basic/digest/MD5/sha265/sha384/sha512
- Realm
- Nonce Value：
- Opaque Value：
- Algorithm：  


封装请求体

# 下级心跳包发送
**保活信令**在上下级之间的用途，制定下级报活的策略并实现；
- 下级向上级发送的保活信令为XML数据，
```xml
<?xml version="1.0"?>\n
<Notify>\r\n
    <CmdType>Keepalive</CmdType>\r\n
    <SN>2749</SN>\r\n
    <DeviceID></DeviceID>\r\n
    <Status>OK</Status>\r\n
</Notify>\r\n
```

下级向上级发送保活信令（实际为封装的XML数据），PJSIP库中的函数``通过回调函数得到上级发送给下级的状态码，然后在自定义的回调函数中，判断该状态码否为200，如果不是200，那么就将上级服务事件的注册状态设置为false；

# 上级处理心跳包的业务逻辑

# 视频目录请求和推送

